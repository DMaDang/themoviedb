<style>
  .movie-header {
    background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
    url("https://image.tmdb.org/t/p/original{{movie.backdrop_path}}") no-repeat center center;
  }
</style>
<div class="container-fluid movie-header">
  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <img src="https://image.tmdb.org/t/p/w500{{movie.poster_path}}" alt="{{movie.title}} Poster"
          class="desc-poster" />
      </div>
      <div class="col-md-9">
        <div class="desc-movie">
          <div class="desc-header">
            <span class="desc-title">{{movie.title}}</span>
            <span class="desc-tagline">{{movie.tagline}}</span>
            <span class="desc-sumary">{{movie.certification}},
              {{movie.release_date}}({{movie.original_language}})
              {{#each movie.genres}}
              {{this.name}},
              {{/each}}
              {{movie.runtime}} phút
            </span>
          </div>
          <div class="desc-score">
            <p><strong>Điểm trung bình:</strong> {{movie.vote_average}} / 10</p>
            <p><strong>Lượt đánh giá:</strong> {{movie.vote_count}}</p>
          </div>
          <div class="desc-interact">
            <div class="desc-interact-btn" id="addToList">
              <i class="fa-solid fa-list"></i>
              Add to list
            </div>
            <div class="desc-interact-btn" id="addToFavorite">
              <i class="fa-solid fa-heart"></i>
              Yêu thích
            </div>
            <div class="desc-interact-btn" id="addToWatchlist">
              <i class="fa-solid fa-bookmark"></i>
              Xem sau
            </div>
            <div class="desc-interact-btn" id="playNow">
              <i class="fa-solid fa-play"></i>
              Xem ngay
            </div>
          </div>
          <div class="desc-movie-info">
            <span class="desc-movie-title">Thông tin phim</span>
            <span class="desc-overview">{{movie.overview}}</span>

          </div>
          <div class="desc-budget-revenue">
            <span><strong><i class="fa-solid fa-dollar-sign"></i>Ngân sách:</strong>
              {{movie.budget}} USD
            </span>
            <span><strong><i class="fa-solid fa-chart-column"></i>Doanh thu:</strong>
              {{movie.revenue}} USD
            </span>
          </div>
          <div class="desc-production">
            <span class="desc-movie-title">Thông tin sản xuất</span>
            <div class="desc-country-company">
              <span><strong>Công ty sản xuất:</strong>
                {{#each movie.production_companies}}
                <span>{{this.name}}</span>{{#unless @last}}, {{/unless}}
                {{/each}}
              </span>
              <span><strong>Quốc gia sản xuất:</strong>
                {{#each movie.production_countries}}
                <span>{{this.name}}</span>{{#unless @last}}, {{/unless}}
                {{/each}}
            </div>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container ">
  <div class="trailer-section">
    <div class="row cast-scroll">
      <h3 class="title-h3" style="margin-bottom: -5px;">Trailer phim</h3>
    </div>
    <div class="row cast-scroll">
      <div class="trailer ">
        {{#if movie.videos.length}}
        {{#each movie.videos}}
        <div class="col-md-4 col-sm-6 col-4">
          <iframe src="https://www.youtube.com/embed/{{this.key}}" allowfullscreen></iframe>
        </div>
        {{/each}}
        {{else}}
        <div class="col-md-4 col-sm-6 col-4">
          <p>Hiện tại chưa có trailer của phim.</p>
        </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>


<div class="container ">
  <div class="casting-section">
    <div class="row cast-scroll">
      <div class="col-12">
        <h3 class="title-h3" style="margin-bottom: -5px;">Diễn viên</h3>
      </div>
    </div>
    <div class="row cast-scroll">
      <div class="col-md-12">
        <div class="cast-scroll">
          {{#if movie.cast.length}}
          {{#each movie.cast}}
          <a href="/person/{{this.id}}" class="a-none-css">
            <div class="cast-item">
              <img src="https://image.tmdb.org/t/p/w500{{this.profile_path}}" alt="{{this.name}}"
                class="rounded-circle" />
              <p>{{this.name}}</p>
              <p><i>{{this.character}}</i></p>
            </div>
          </a>
          {{/each}}
          {{else}}
          <p>Chưa có thông tin về diễn viên</p>
          {{/if}}
        </div>
      </div>
    </div>
  </div>

  <!-- Crew Section -->
  <div class="row">
    <div class="casting-section">
      <div class="col-md-12">
        <h3>Đoàn làm phim</h3>
        <div class="cast-scroll">
          {{#if movie.crew.length}}
          {{#each movie.crew}}
          <a href="/person/{{this.id}}" class="a-none-css">
            <div class="cast-item">
              <img src="https://image.tmdb.org/t/p/w500{{this.profile_path}}" alt="{{this.name}}"
                class="rounded-circle" />
              <p>{{this.name}}</p>
              <p><i>{{this.job}}</i></p>
            </div>
          </a>
          {{/each}}
          {{else}}
          <p>Chưa có thông tin về đoàn làm phim</p>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="casting-section">

      <div class="col-md-12">
        <h3>Đánh giá phim</h3>
        {{#if movie.reviews.length}}
        <div class="reviews-scroll">
          {{#each movie.reviews}}
          <div class="review-item">
            <p><strong>{{this.author}}</strong>
              <span class="text-muted">({{this.created_at}})</span>
            </p>
            <p>{{this.content}}</p>
          </div>
          {{/each}}
        </div>
        {{else}}
        <p>Chưa có đánh giá cho phim này.</p>
        {{/if}}
      </div>
    </div>
  </div>

</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const movieId = "{{movie.id}}"; // ID của phim hiện tại
    const mediaType = "movie"; // Loại nội dung (movie hoặc tv)
    const accountId = "{{account.id}}"; // Lấy accountId từ server nếu có
    const sessionId = "{{sessionId}}"; // Lấy sessionId từ server nếu có

    console.log("Movie ID:", movieId);
    console.log("Account ID:", accountId);
    console.log("Session ID:", sessionId);

    document.getElementById('addToFavorite').addEventListener('click', async () => {
      console.log("Clicked Add to Favorite button");
      const requestBody = { accountId, mediaId: movieId, mediaType, favorite: true };
      console.log("Request Body:", requestBody);

      try {
        const response = await fetch('/person/favorite', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(requestBody),
        });

        console.log("Response:", response);
        const result = await response.json();
        console.log("Response JSON:", result);

        alert(result.message || 'Thêm vào danh sách yêu thích thành công!');
      } catch (error) {
        console.error('Error:', error);
        alert('Đã xảy ra lỗi khi thêm vào danh sách yêu thích.');
      }
    });

    document.getElementById('addToWatchlist').addEventListener('click', async () => {
      console.log("Clicked Add to Watchlist button");
      const requestBody = { accountId, mediaId: movieId, mediaType, watchlist: true };
      console.log("Request Body:", requestBody);

      try {
        const response = await fetch('/person/add-watchlist', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(requestBody),
        });

        console.log("Response:", response);
        const result = await response.json();
        console.log("Response JSON:", result);

        alert(result.message || 'Thêm vào danh sách xem sau thành công!');
      } catch (error) {
        console.error('Error:', error);
        alert('Đã xảy ra lỗi khi thêm vào danh sách xem sau.');
      }
    });

    document.getElementById('addToList').addEventListener('click', async () => {
      console.log("Clicked Add to List button");
      const listId = prompt('Nhập ID danh sách muốn thêm vào:');
      if (!listId) {
        console.log("No list ID provided.");
        return alert('Vui lòng nhập ID danh sách.');
      }

      const requestBody = { listId, mediaId: movieId };
      console.log("Request Body:", requestBody);

      try {
        const response = await fetch('/person/add-list', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(requestBody),
        });

        console.log("Response:", response);
        const result = await response.json();
        console.log("Response JSON:", result);

        alert(result.message || 'Thêm vào danh sách thành công!');
      } catch (error) {
        console.error('Error:', error);
        alert('Đã xảy ra lỗi khi thêm vào danh sách.');
      }
    });

    document.getElementById('playNow').addEventListener('click', () => {
      console.log("Clicked Play Now button");
      alert('Chức năng "Xem ngay" đang được phát triển.');
    });
  });
</script>
